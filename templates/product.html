{% extends "base.html" %}

{% block content %}

<main class="mt-5 pt-4">
  <div class="container mt-5">

    <!-- Product Section -->
    <div class="row wow fadeIn mb-4">

      <!-- Product Image -->
      <div class="col-md-5 mb-3">
        <div class="product-image-wrapper position-relative">
          {% if object.image %}
          <img src="{{ object.image.url }}" class="img-fluid rounded shadow w-100" alt="{{ object.title }}"
            style="object-fit: cover; max-height: 350px;">
          {% else %}
          <img src="https://via.placeholder.com/400x350?text=No+Image" class="img-fluid rounded shadow" alt="No image">
          {% endif %}

          {% if object.discount_price %}
          <span class="badge badge-danger position-absolute"
            style="top: 10px; right: 10px; font-size: 0.8rem; padding: 5px 10px;">
            GIẢM GIÁ
          </span>
          {% endif %}
        </div>
      </div>

      <!-- Product Info -->
      <div class="col-md-7 mb-3">
        <div class="p-3 bg-light rounded shadow-sm h-100">
          <h4 class="mb-2 font-weight-bold text-dark">{{ object.title }}</h4>

          <div class="mb-3">
            <span class="badge badge-info px-2 py-1" style="font-size: 0.85rem;">
              {{ object.get_category_display }}
            </span>
          </div>

          <!-- Price Section -->
          <div class="mb-3 p-2 bg-white rounded border">
            {% if object.discount_price %}
            <div class="d-flex align-items-center">
              <span class="text-muted mr-2" style="font-size: 1rem;"><del>${{ object.price }}</del></span>
              <span class="text-danger font-weight-bold" style="font-size: 1.5rem;">${{ object.discount_price }}</span>
            </div>
            {% else %}
            <span class="text-success font-weight-bold" style="font-size: 1.5rem;">${{ object.price }}</span>
            {% endif %}
          </div>

          <!-- Description -->
          <div class="mb-3">
            <h6 class="font-weight-bold text-dark mb-2">Mô tả sản phẩm</h6>
            <p class="text-muted small" style="line-height: 1.6;">{{ object.description }}</p>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex flex-wrap gap-2">
            <a href="{{ object.get_add_to_cart_url }}" class="btn btn-primary btn-md flex-fill shadow-sm">
              Thêm vào giỏ
            </a>
            <a href="{{ object.get_remove_from_cart_url }}" class="btn btn-outline-danger btn-md shadow-sm"
              style="min-width: 120px;">
              Xóa
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Technical Specifications -->
    <div class="row wow fadeIn mb-3">
      <div class="col-12">
        <div class="card shadow-sm border-0 specs-card">
          <div class="card-header text-white" style="background: #667eea; border-radius: 15px 15px 0 0;">
            <h6 class="mb-0 py-2">Thông số kỹ thuật</h6>
          </div>
          <div class="card-body p-3" style="border-radius: 0 0 15px 15px;">
            {% if object.specs %}
            <table class="table table-hover table-sm mb-0">
              <tbody>
                {% for key, value in object.specs.items %}
                <tr>
                  <th class="w-25 bg-light text-dark" style="font-size: 0.9rem;">{{ key }}</th>
                  <td class="text-muted" style="font-size: 0.9rem;">{{ value }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <p class="text-center text-muted mb-0 py-3 small">
              Chưa có thông số kỹ thuật cho sản phẩm này.
            </p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="row wow fadeIn mb-3">
      <div class="col-12">
        <div class="card shadow-sm border-0 reviews-card">
          <div class="card-header text-white" style="background: #667eea; border-radius: 15px 15px 0 0;">
            <h6 class="mb-0 py-2">Đánh giá sản phẩm</h6>
          </div>
          <div class="card-body p-3" style="border-radius: 0 0 15px 15px;">
            {% if object.reviews.all %}
            <div class="reviews-container">
              {% for review in object.reviews.all %}
              <div class="review-item border rounded p-3 mb-2 bg-light">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong class="text-dark" style="font-size: 0.95rem;">{{ review.user.username }}</strong>
                  <div class="text-warning" style="font-size: 1rem;">
                    {% for i in "12345" %}
                    {% if forloop.counter <= review.rating %}★{% else %}☆{% endif %} {% endfor %} </div>
                  </div>
                  <p class="mb-0 text-muted small" style="line-height: 1.5;">{{ review.comment }}</p>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <p class="text-center text-muted mb-0 py-3 small">
                Chưa có đánh giá nào cho sản phẩm này.
              </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Review Form -->
      <div class="row wow fadeIn mb-4">
        <div class="col-12">
          <div class="card shadow-sm border-0 form-card">
            <div class="card-header text-white" style="background: #667eea; border-radius: 15px 15px 0 0;">
              <h6 class="mb-0 py-2">Viết đánh giá của bạn</h6>
            </div>
            <div class="card-body p-3" style="border-radius: 0 0 15px 15px;">
              <form method="POST">
                {% csrf_token %}
                <div class="form-group">
                  <label class="font-weight-bold text-dark small">Đánh giá (1-5 sao)</label>
                  <select name="rating" class="form-control form-control-sm" style="max-width: 250px;">
                    <option value="5">★★★★★ Tuyệt vời</option>
                    <option value="4">★★★★☆ Rất tốt</option>
                    <option value="3">★★★☆☆ Tốt</option>
                    <option value="2">★★☆☆☆ Trung bình</option>
                    <option value="1">★☆☆☆☆ Kém</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="font-weight-bold text-dark small">Nhận xét của bạn</label>
                  <textarea name="comment" class="form-control form-control-sm" rows="3"
                    placeholder="Chia sẻ trải nghiệm của bạn về sản phẩm này..."></textarea>
                </div>
                <button type="submit" class="btn btn-sm shadow-sm px-4 text-white" style="background: #667eea;">
                  Gửi đánh giá
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
</main>

<style>
  .product-image-wrapper img {
    transition: transform 0.3s ease;
  }

  .product-image-wrapper:hover img {
    transform: scale(1.05);
  }

  .btn {
    transition: all 0.3s ease;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .review-item {
    transition: all 0.3s ease;
  }

  .review-item:hover {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transform: translateX(5px);
  }

  /* Card sections with hover effect */
  .specs-card,
  .reviews-card,
  .form-card {
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .specs-card:hover,
  .reviews-card:hover,
  .form-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2) !important;
  }
</style>

{% endblock content %}